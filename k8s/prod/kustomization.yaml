## Edit server FQDN here
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Updated resources list: 05-ingress.yaml is removed, 05-gateway.yaml is added
resources:
  - 01-config.yaml
  - 02-issuer.yaml
  - 03-infra.yaml
  - 04-apps.yaml
  - 05-gateway.yaml
  - 06-hpa.yaml
  - 07-network-policy.yaml

patches:
  # 1. Update the Gateway Listeners
  - target:
      kind: Gateway
      name: inventory-gateway
    patch: |-
      - op: replace
        path: /spec/listeners/0/hostname
        value: "__SERVER_NAME__"
      - op: replace
        path: /spec/listeners/1/hostname
        value: "__SERVER_NAME__"

  # 2. Update the HTTPS App Route
  - target:
      kind: HTTPRoute
      name: inventory-app-route
    patch: |-
      - op: replace
        path: /spec/hostnames/0
        value: "__SERVER_NAME__"

  # 3. Update the HTTP Redirect Route
  - target:
      kind: HTTPRoute
      name: http-to-https-redirect
    patch: |-
      - op: replace
        path: /spec/hostnames/0
        value: "__SERVER_NAME__"

  # 4. Update the ConfigMap (passed to Nginx-frontend  SERVER_NAME)
  - target:
      kind: ConfigMap
      name: application-config
    patch: |-
      - op: replace
        path: /data/SERVER_NAME
        value: "__SERVER_NAME__"

  # 5. Update the Secret
  - target:
      kind: Secret
      name: inventory-secrets
    patch: |-
      - op: replace
        path: /stringData/REDIS_PASSWORD
        value: "__REDIS_PASSWORD__"
      - op: replace
        path: /stringData/MONGO_URI
        value: "__MONGO_URI__"